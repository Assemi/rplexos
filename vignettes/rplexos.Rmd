<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{rplexos: Process and read PLEXOS files}
-->


# Processing solutions

`rplexos` is an R package developed to read and analyze PLEXOS solutions. It currently supports the
conversion of PLEXOS solution files into SQLite databases and functions to query those databases.

The first step is to load the package into memory.

```{r, message = FALSE}
library(rplexos)
```

The rest of this file presents the preferred workflow to process PLEXOS solutions with this package.
We will use an example database that comes preloaded with the package. This is the location of that
database in your system.

```{r}
location <- system.file("extdata", "solution", package = "rplexos")
location
```


## Organize and process solutions

It is recommended to create a folder for each of your scenarios. If a run is divided in different
solution files, copy them together in the same folder.

For each folder, run the following command to convert the zip file into a SQLite database.

```{r}
process_folder(location)
```

We can also provide a vector of strings with the names of all the folders that need to be processed.
For example, let us assume we have two scenarios loaded in two folders: `HiWind` and `HiSolar`. 

```
process_folder(c("HiWind", "HiSolar"))
```


## Open databases

Once the databases have been processed, we can access them by first opening a connection with `plexos_open`.
Scenarios names can be defined at this point (if not provided, they default to the folder names).

```{r}
db <- plexos_open(location, "Sc1")
```

Again, you can provide a vector of folders to open and a vector of scenario names.

```
db <- plexos_open(c("HiWind", "HiSolar"), name = c("High Wind", "High Solar"))
```


## Query data

We can now use the `db` object to query and aggregate data using the functions documented in `query_master`.
The list of available properties can be seen with `?query_property`.

```{r}
query_property(db)
```

There are also a number of queries that can be used to explore the contents of the solutions. For example,
let's take a look at the list of generators:

```{r}
query_generator(db)
```

The following command 

```{r}
query_day(db, "Generator", "Generation")
```

AAA

```{r}
query_day(db, "Region", "*")
```



```{r}
gen <- query_interval(db, "Generator", "Generation")
library(ggplot2)
ggplot(gen, aes(x = time, y = value, fill = name)) +
  geom_area()
```



```{r}
price <- query_interval(db, "Node", "Price")
ggplot(price, aes(x = time, y = value, color = name)) +
  geom_line()
```

```{r}
price <- query_interval(db, "Line", "Flow")
ggplot(price, aes(x = time, y = value, color = name)) +
  geom_line()
```



# Processing inputs

`rplexos` also supports converting PLEXOS input databases (which are saved as XML file) into SQLite files.
We will use an example database that comes preloaded with the package. This is the location of that
database in your system.

```{r, message = FALSE}
library(rplexos)
location <- system.file("extdata", "database", package = "rplexos")
location
```


The input files are processed with the same function that is used for the solutions.

```{r}
process_folder(location)
```
